---
layout: post
category : 分布式系统
tagline: "Supporting tagline"
tags : [zookeeper]
---
{% include JB/setup %}


在涉及到多机房业务的时候，zookeeper也会出现跨机房的集群。因此不免会需要调整zookeeper集群。
如：机房迁移（业务系统迁移和相关的基础服务系统迁移）。整个迁移方案就以核心机房从A迁移到机房C（灾备机房B不变），在迁移业务系统前，基础组件应先迁移，并且不能影响现有业务。zookeeper是基础组件之一，要想既不影响现有业务，又支持新机房上线业务，因此添加zookeeper节点。

### 当前集群情况
server.1=192.168.19.121:2888:3888<br>
server.2=192.168.19.122:2888:3888<br>
server.3=192.168.19.123:2888:3888<br>
server.4=10.3.5.40:2888:3888:observer<br>
server.5=10.3.5.41:2888:3888:observer<br>
1,2,3节点在A机房，4，5在B机房。

### 添加后集群情况
server.1=192.168.19.121:2888:3888<br>
server.2=192.168.19.122:2888:3888<br>
server.3=192.168.19.123:2888:3888<br>
server.4=10.3.5.40:2888:3888:observer<br>
server.5=10.3.5.41:2888:3888:observer<br>
server.6=10.3.6.51:2888:3888<br>
server.7=10.3.7.52:2888:3888<br>
1,2,3节点在A机房，4，5在B机房，6,7在C机房。

### 添加过程

 1. 在原有zoo.cfg配置文件的基础上添加节点6和7。下面的调整的节点都以新的zoo.cfg文件为准。
 2. 在C机房启动节点6和7。
 3. 调整B机房的4节点。
 4. 调整B机房的5节点。
 5. 在调整A机房不是Leader的两个节点。
 6. 最后调整A机房是Leader的那个节点。、
 7. 整个添加节点的过程完成。
        
 > 整个过程会发生一次选举。
